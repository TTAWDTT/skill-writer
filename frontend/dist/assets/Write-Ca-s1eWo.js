import{_ as E,w as G,o as I,c as r,a as e,t as m,d as l,g as N,b as p,h as _,F as U,r as W,n as $,i as O,v as q,j as K,e as D,k as C,l as J,f as n,m as Y}from"./index-ChbF3Mf5.js";import{m as A}from"./marked.esm-CURnbxgz.js";import{a as S}from"./index-B-0QbnVn.js";const Q={class:"flex h-[calc(100vh-140px)] gap-6"},X={class:"flex-1 flex flex-col bg-warm-50 rounded-2xl border border-warm-300 overflow-hidden"},Z={class:"px-6 py-4 border-b border-warm-300 bg-warm-100"},ee={class:"flex items-center gap-3"},te={class:"font-semibold text-dark-300"},ae={class:"text-xs text-dark-50"},se={key:0,class:"ml-2 text-anthropic-orange"},oe={class:"whitespace-pre-wrap text-sm leading-relaxed"},re={key:0,class:"bg-warm-200 text-dark-300 max-w-[85%] p-4 rounded-2xl border border-warm-300"},ne={key:1,class:"bg-warm-200 border border-anthropic-orange-light text-dark-300 p-5 rounded-2xl"},le={key:0,class:"text-sm"},ie={class:"flex justify-between mb-2 text-dark-50"},de={class:"w-full bg-warm-300 rounded-full h-2"},ce={key:0,class:"mt-3 text-xs text-dark-50"},ue={class:"p-4 border-t border-warm-300 bg-warm-100"},ve={class:"flex gap-3"},me=["disabled"],pe=["disabled"],he={class:"w-[45%] flex flex-col bg-warm-50 rounded-2xl border border-warm-300 overflow-hidden"},we={class:"px-6 py-4 border-b border-warm-300 bg-warm-100 flex items-center justify-between"},ge={class:"flex gap-2"},fe={class:"flex-1 overflow-y-auto p-6"},xe=["innerHTML"],be={key:1,class:"h-full flex items-center justify-center"},ke={key:2,class:"h-full flex items-center justify-center"},ye={__name:"Write",setup(_e){const T=J(),j=_(()=>T.params.skillId),b=l(null),k=l(null),i=l([]),g=l(""),u=l(!1),d=l(!1),f=l(!1),s=l(""),h=l("init"),x=l(null),w=l(""),c=l({current:0,total:0}),V=_(()=>({init:"Initializing",requirement:"Collecting Requirements",writing:"Generating Document",review:"Reviewing",complete:"Complete",error:"Error"})[h.value]||h.value),B=_(()=>s.value?A(s.value):""),L=async()=>{try{const a=await S.get(`/skills/${j.value}`);b.value=a.data}catch(a){console.error("Failed to fetch skill:",a)}},P=async()=>{u.value=!0;try{const a=await S.post("/chat/start",{skill_id:j.value});k.value=a.data.session_id,h.value=a.data.phase,i.value.push({role:"assistant",content:a.data.message})}catch(a){console.error("Failed to start conversation:",a),i.value.push({role:"assistant",content:"Sorry, failed to start the conversation. Please ensure the backend server is running."})}finally{u.value=!1}},M=async()=>{const a=g.value.trim();if(!(!a||u.value||d.value)){i.value.push({role:"user",content:a}),g.value="",u.value=!0,await C(),y();try{const t=await S.post("/chat/message",{session_id:k.value,message:a});h.value=t.data.phase,f.value=t.data.is_complete,i.value.push({role:"assistant",content:t.data.message}),t.data.phase==="writing"&&(u.value=!1,await R()),t.data.document&&(s.value=t.data.document)}catch(t){console.error("Failed to send message:",t),i.value.push({role:"assistant",content:"Sorry, failed to send. Please try again."})}finally{u.value=!1,await C(),y()}}},R=async()=>{d.value=!0,s.value="",c.value={current:0,total:0};try{const a=new EventSource(`/api/chat/generate/${k.value}/stream`);a.onmessage=t=>{const o=JSON.parse(t.data);switch(o.type){case"start":c.value.total=o.total_sections;break;case"section_start":w.value=o.section_title,c.value.current=o.section_index;break;case"chunk":s.value+=o.content;break;case"section_complete":break;case"complete":d.value=!1,f.value=!0,h.value="complete",w.value="",s.value=o.document,a.close(),i.value.push({role:"assistant",content:"Document generation complete! You can preview and download it on the right."});break;case"error":d.value=!1,h.value="error",a.close(),i.value.push({role:"assistant",content:`Generation failed: ${o.error}`});break}},a.onerror=t=>{console.error("SSE error:",t),d.value=!1,a.close()}}catch(a){console.error("Failed to start generation:",a),d.value=!1,i.value.push({role:"assistant",content:"Document generation failed. Please try again."})}},y=()=>{x.value&&(x.value.scrollTop=x.value.scrollHeight)},z=()=>{s.value&&(navigator.clipboard.writeText(s.value),alert("Copied to clipboard"))},F=()=>{var a;if(s.value){const t=new Blob([s.value],{type:"text/markdown"}),o=URL.createObjectURL(t),v=window.document.createElement("a");v.href=o,v.download=`${((a=b.value)==null?void 0:a.name)||"document"}.md`,v.click(),URL.revokeObjectURL(o)}};return G(i,()=>{C(()=>y())},{deep:!0}),I(async()=>{await L(),await P()}),(a,t)=>{var o;return n(),r("div",Q,[e("div",X,[e("div",Z,[e("div",ee,[t[1]||(t[1]=e("div",{class:"w-10 h-10 bg-gradient-to-br from-anthropic-orange to-anthropic-orange-dark rounded-xl flex items-center justify-center shadow-sm"},[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})])],-1)),e("div",null,[e("h3",te,m(((o=b.value)==null?void 0:o.name)||"Loading..."),1),e("p",ae,[N(" Phase: "+m(V.value)+" ",1),w.value?(n(),r("span",se,"| Writing: "+m(w.value),1)):p("",!0)])])])]),e("div",{ref_key:"messagesContainer",ref:x,class:"flex-1 overflow-y-auto p-6 space-y-4"},[(n(!0),r(U,null,W(i.value,(v,H)=>(n(),r("div",{key:H,class:Y(["max-w-[85%] p-4 rounded-2xl",v.role==="user"?"ml-auto bg-anthropic-orange text-white shadow-sm":"bg-warm-200 text-dark-300 border border-warm-300"])},[e("div",oe,m(v.content),1)],2))),128)),u.value?(n(),r("div",re,[...t[2]||(t[2]=[e("span",{class:"inline-flex space-x-1.5"},[e("span",{class:"w-2 h-2 bg-anthropic-orange rounded-full animate-bounce"}),e("span",{class:"w-2 h-2 bg-anthropic-orange rounded-full animate-bounce",style:{"animation-delay":"0.1s"}}),e("span",{class:"w-2 h-2 bg-anthropic-orange rounded-full animate-bounce",style:{"animation-delay":"0.2s"}})],-1)])])):p("",!0),d.value?(n(),r("div",ne,[t[3]||(t[3]=e("div",{class:"flex items-center gap-3 mb-3"},[e("div",{class:"w-5 h-5 border-2 border-warm-300 border-t-anthropic-orange rounded-full animate-spin"}),e("span",{class:"font-medium text-dark-300"},"Generating document...")],-1)),c.value.total>0?(n(),r("div",le,[e("div",ie,[e("span",null,m(c.value.current)+" / "+m(c.value.total)+" sections",1),e("span",null,m(Math.round(c.value.current/c.value.total*100))+"%",1)]),e("div",de,[e("div",{class:"bg-gradient-to-r from-anthropic-orange to-anthropic-orange-dark h-2 rounded-full transition-all duration-300",style:$({width:c.value.current/c.value.total*100+"%"})},null,4)]),w.value?(n(),r("p",ce,"Current: "+m(w.value),1)):p("",!0)])):p("",!0)])):p("",!0)],512),e("div",ue,[e("div",ve,[O(e("input",{"onUpdate:modelValue":t[0]||(t[0]=v=>g.value=v),onKeyup:K(M,["enter"]),disabled:u.value||d.value||f.value,type:"text",placeholder:"Type your response...",class:"flex-1 px-5 py-3 bg-warm-50 border border-warm-300 rounded-xl text-dark-300 placeholder-warm-400 focus:outline-none focus:ring-2 focus:ring-anthropic-orange focus:border-transparent disabled:bg-warm-200 disabled:text-warm-400 transition-all"},null,40,me),[[q,g.value]]),e("button",{onClick:M,disabled:!g.value.trim()||u.value||d.value||f.value,class:"px-6 py-3 bg-anthropic-orange text-white rounded-xl font-medium hover:bg-anthropic-orange-dark disabled:bg-warm-300 disabled:text-warm-400 disabled:cursor-not-allowed transition-colors shadow-sm hover:shadow-md"}," Send ",8,pe)])])]),e("div",he,[e("div",we,[t[4]||(t[4]=D('<div class="flex items-center gap-3" data-v-da24c229><div class="w-10 h-10 bg-warm-200 rounded-xl flex items-center justify-center" data-v-da24c229><svg class="w-5 h-5 text-dark-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-da24c229><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-da24c229></path></svg></div><h3 class="font-semibold text-dark-300" data-v-da24c229>Document Preview</h3></div>',1)),e("div",ge,[s.value?(n(),r("button",{key:0,onClick:z,class:"px-4 py-2 text-sm bg-warm-200 text-dark-100 rounded-xl hover:bg-warm-300 transition-colors font-medium"}," Copy ")):p("",!0),s.value?(n(),r("button",{key:1,onClick:F,class:"px-4 py-2 text-sm bg-anthropic-orange text-white rounded-xl hover:bg-anthropic-orange-dark transition-colors font-medium shadow-sm"}," Download ")):p("",!0)])]),e("div",fe,[s.value?(n(),r("div",{key:0,class:"markdown-content prose prose-warm max-w-none",innerHTML:B.value},null,8,xe)):d.value?(n(),r("div",be,[...t[5]||(t[5]=[e("div",{class:"text-center"},[e("div",{class:"w-12 h-12 border-3 border-warm-300 border-t-anthropic-orange rounded-full animate-spin mx-auto"}),e("p",{class:"mt-4 text-dark-50 font-medium"},"Generating document...")],-1)])])):(n(),r("div",ke,[...t[6]||(t[6]=[D('<div class="text-center" data-v-da24c229><div class="w-16 h-16 bg-warm-200 rounded-2xl flex items-center justify-center mx-auto mb-4" data-v-da24c229><svg class="w-8 h-8 text-warm-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-da24c229><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-da24c229></path></svg></div><p class="text-dark-100 font-medium" data-v-da24c229>Document Preview</p><p class="text-sm text-warm-400 mt-1" data-v-da24c229>Complete the conversation to generate your document</p></div>',1)])]))])])])}}},Me=E(ye,[["__scopeId","data-v-da24c229"]]);export{Me as default};
